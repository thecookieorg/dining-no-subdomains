<script src="//maps.google.com/maps/api/js?v=3.23&key=AIzaSyCrY_tAbpSJaUfG3EGnjWSEX7wyI3x9PfQ"></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->


<%= render 'locations/navbar' %>

<div class="container">
  <div class="row">
    <div class="jumbotron">
      <h1>Welcome to <%= @location.name %>!</h1>
      <p><%= @location.about %></p>
    </div>
  </div><!-- end row -->

  <div class="row" style="margin-top: 30px;">
    <div class="col-md-6">
      <% @location.categories.each do |c| %>
        <h1><%= c.name %></h1>
        <ul>
        <% c.products.each do |p| %>
          <li>
            <div class="panel panel-default">
              <div class="panel-heading">
                <h3 class="panel-title"><%= p.name %></h3>
              </div>
              <div class="panel-body">
                <p><%= p.description %></p>
                <p>Price: <%= number_to_currency(p.price) %></p>
                <% p.sizes.each do |s| %>
                  <p><%= s.size_description %></p>
                  <p><%= number_to_currency(s.size_based_price) %></p>
                <% end %>
              </div>
            </div>
          </li>
        <% end %>
      </ul>
      <% end %>
    </div><!-- end col-md-8 -->
    <div class="col-md-4" style="margin-top: 73px;">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">Working Hours</h3>
        </div>
        <div class="panel-body">
          <p>Hours</p>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">Location</h3>
        </div>
        <div class="panel-body">
          <div style='width: 100%;'>
            <div id="custom_style" style='width: 100%; height: 400px;'></div>
          </div>
        </div>
      </div>
    </div><!-- end col-md-3 -->
    <div class="col-md-2" style="margin-top: 73px;">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">Cart</h3>
        </div>
        <div class="panel-body">
          <p>Hours</p>
        </div>
      </div>
    </div><!-- end col-md-3 -->
  </div><!-- end row -->
</div><!-- end container -->


<script>
var mapStyle = [{"featureType":"administrative","elementType":"labels.text.fill","stylers":[{"color":"#444444"}]},{"featureType":"administrative.country","elementType":"geometry.fill","stylers":[{"visibility":"on"}]},{"featureType":"administrative.province","elementType":"labels.icon","stylers":[{"hue":"#ff0000"},{"visibility":"on"}]},{"featureType":"landscape","elementType":"all","stylers":[{"color":"#f2f2f2"}]},{"featureType":"poi","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"road","elementType":"all","stylers":[{"saturation":-100},{"lightness":45}]},{"featureType":"road.highway","elementType":"all","stylers":[{"visibility":"simplified"}]},{"featureType":"road.arterial","elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"transit","elementType":"all","stylers":[{"visibility":"off"}]},{"featureType":"water","elementType":"all","stylers":[{"color":"#46bcec"},{"visibility":"on"}]}];

/*
var directionsDisplay = new google.maps.DirectionsRenderer();
var directionsService = new google.maps.DirectionsService();

function calcRoute() {
  var origin      = new google.maps.LatLng("<%= @location.latitude %>", "<%= @location.longitude %>");
  var destination = new google.maps.LatLng(userLocation.lat(), userLocation.lng());
  var request = {
      origin:      origin,
      destination: destination,
      travelMode:  google.maps.TravelMode.DRIVING
  };
  directionsService.route(request, function(response, status) {
    if (status == google.maps.DirectionsStatus.OK) {
      directionsDisplay.setDirections(response);
    }
  });
}

calcRoute(); // call this anywhere you want
*/

handler = Gmaps.build('Google');
handler.buildMap({ provider: {mapTypeId: google.maps.MapTypeId.ROADMAP, styles: mapStyle}, internal: {id: 'custom_style'}}, function(){
  markers = handler.addMarkers(<%=raw @hash.to_json %>);
  //directionsDisplay.setMap(handler.getMap());
  handler.bounds.extendWith(markers);
  handler.fitMapToBounds();
  handler.getMap().setZoom(15);
});
</script>
